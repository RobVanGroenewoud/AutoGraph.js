// jquery.autograph.js
// Utility
typeof Object.create!="function"&&(Object.create=function(e){function t(){}t.prototype=e;return new t});(function(e,t,n,r){var i={init:function(t,n){var r=this;r.elem=n;r.$elem=e(n);r.progressBar=e('<div class="progress progress-striped active"><div class="bar" style="width: 100%;"></div></div');r.options=e.extend({},e.fn.AutoGraph.options,t);r.run()},run:function(){var t=this;t.dataUrl=t.$elem.attr("data-graph-url");var n=setTimeout(function(){t.$elem.prepend(t.progressBar)},200);t.fetch().done(function(e){t.buildGraphOptions(e);t.displayGraph()}).error(function(n,r,i){var s=e("<div>Unable to load data from '"+t.dataUrl+"'</div>").addClass(t.options.errorClassName);t.$elem.prepend(s)}).complete(function(){clearTimeout(n);t.progressBar.hide()})},fetch:function(){return e.ajax({url:this.dataUrl,cache:!1,dataType:"xml"})},buildGraphOptions:function(t){var n=this,r=n.$elem.attr("data-graph-title"),i=n.$elem.attr("data-graph-type"),s=n.$elem.attr("data-graph-categories"),o=n.$elem.attr("data-graph-yaxis-text"),u=n.$elem.attr("data-graph-stacking"),a={chart:{renderTo:n.elem,type:i||n.options.graphType},credits:{enabled:!1},title:{text:r},xAxis:{categories:[]},yAxis:{title:{text:o}},plotOptions:{series:{stacking:u}},series:[]},f=e(t);a.title.text=a.title.text||f.find("title").text();a.yAxis.title.text=a.yAxis.title.text||f.find("yAxis text").text();a.chart.type=a.chart.type||f.find("type").text();var l=s||f.find("categories").text();e.each(l.split(","),function(e,t){a.xAxis.categories.push(t)});var c=!1;f.find("series").each(function(t,n){var r=e(n).find("hidden").text()==="true",i=e(n).find("stack").text(),s=i?i:null;c=c||i.length>0;var o={name:e(n).find("name").text(),data:[],visible:!r,stack:s},u=e(n).find("data").text();e.each(u.split(","),function(e,t){o.data.push(parseInt(t,10))});a.series.push(o)});n.graphOptions=a},displayGraph:function(){var e=this;e.chart=new Highcharts.Chart(e.graphOptions)}};e.fn.AutoGraph=function(t){return this.each(function(){var n=Object.create(i);n.init(t,this);e.data(this,"AutoGraph",n)})};e.fn.AutoGraph.options={errorClassName:"alert alert-error",graphType:"column"}})(jQuery,window,document);